# Master's Thesis Data Generation Tool
_This repository contains code used to implement [my Master's Thesis](https://github.com/gussmith23/masters-thesis/releases/). Thesis code documentation: [ms-thesis-doc](https://github.com/gussmith23/ms-thesis-doc)._

This repository contains a tool for easily generating and parsing the results for my MS thesis. It works as follows:

Generating results is abstracted into a build process, where instead of building binaries, we are building "result sets" -- i.e., groups of results produced by running a set of LLVM passes on a set of programs. This sort of abstraction is easily supported in CMake, which the tool is mostly written in. 

The main file is the CMakeLists.txt in the root directory. This file does a number of important things:
- __Collects dependencies.__ See [Generating Results.](generating-results)
- __Defines collections of programs available for running passes on.__ In my thesis, I used only a small subset of available programs. These are defined as CMake lists, and used by multiple result sets.
- __Defines the `add_benchmark_group` function.__ This is the function that does most of the legwork. It is used to add result sets. See [this issue](https://github.com/gussmith23/masters-thesis-data-generation/issues/1) regarding the uninformative name of the function.
- Finally, adds all subdirectories, which contain the actual definitions of the result sets.

The programs which are available to run passes on come from the LLVM test-suite project. See [Generating Results.](generating-results)

Each subdirectory represents its own results set. Inside each of these directories is a CMakeLists.txt which calls `add_benchmark_group`. This function takes:
- The programs to run on.
- The LLVM pass(es) to run on these programs.
- A "summary script" which is run on the result files to produce a summary file.

In general, the summary script takes the results generated by running the LLVM pass on a number of programs, creates summary tables (i.e. histograms of opcodes), and writes them to a new summary file. Example Python summary scripts can be found in this repository. Currently, these Python scripts make a number of tables and format them roughly in LaTeX tabular format. 

## Generating Results
```shell
git clone https://github.com/gussmith23/masters-thesis-data-generation
cd masters-thesis-data-generation
mkdir build && cd build
cmake .. -DLLVM_DIR=/path/to/llvm/build/lib/cmake/llvm -DPASS_LIBS_DIR=/path/to/llvm-pim-passes/build/pass-libs \
    -DBENCHMARKS_DIR=/path/to/llvm/projects/test-suite/build
make find-ld-ld-op-st_multisource-applications-selected
```
This example will generate the "find-ld-ld-op-st_multisource-applications-selected" result set.

Note that, if you use a build directory as in the example above (which is the generally-accepted way to build a project from source), all the results will end up in the build directory. The source remains essentially empty other than CMakeLists.txt files which set up each result set. This may seem a little strange, but it has no negative affects on results generation; it's simply a consequence of using CMake.

## Dependencies
- LLVM.
- My [LLVM passes](https://github.com/gussmith23/llvm-pim-passes). Build this repo, and then pass the path to the build/pass-libs dir as `-DPASS_LIBS_DIR`.
- Build LLVM's test-suite project into "monolithic" IR files. [This commit](https://github.com/gussmith23/test-suite/commit/b39d483ae23f685f50af8535761d1ce0bea7cf4a) in my fork of test-suite should help you do this. The project must be built, and then the path to the build folder should be passed as `-DBENCHMARKS_DIR`. [These instructions](https://llvm.org/docs/TestSuiteMakefileGuide.html#running-the-test-suite-via-cmake) contain more information about building test-suite -- note, however, that they use Subversion and not Git. Simply change the svn commands to their analogous git commands and these instructions will work.
- The Python files were made for Python 2.7 on Linux. Hopefully they should work for Python 3, but they might not be cross-platform.
